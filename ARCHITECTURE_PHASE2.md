# ğŸ—ï¸ PHASE 2 - COMPLETE ARCHITECTURE

## System Architecture Diagram

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         NASHAMA VISION - PHASE 2                     â”ƒ
â”ƒ                     Advanced Football Analytics Platform              â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ‘¤ USER INTERFACE LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React 18 + Tailwind CSS + React Query + Recharts                   â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“„ Pages:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Match Details  â”‚  â”‚ Player Metrics â”‚  â”‚ Heatmap View   â”‚       â”‚
â”‚  â”‚ - Overview     â”‚  â”‚ - Metric Cards â”‚  â”‚ - Canvas Pitch â”‚       â”‚
â”‚  â”‚ - Player List  â”‚  â”‚ - Speed Chart  â”‚  â”‚ - Intensity    â”‚       â”‚
â”‚  â”‚ - Actions      â”‚  â”‚ - Stamina      â”‚  â”‚ - Team Toggle  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                      â”‚
â”‚  ğŸ§© Components:                                                      â”‚
â”‚  â€¢ MetricCard.jsx       â€¢ HeatmapCanvas.jsx                         â”‚
â”‚                                                                      â”‚
â”‚  ğŸª Hooks:                                                           â”‚
â”‚  â€¢ useMatchAnalytics    â€¢ usePlayerMetrics                          â”‚
â”‚  â€¢ usePlayerTimeSeries  â€¢ usePlayerHeatmap                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP/REST
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸŒ API GATEWAY LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI + Uvicorn                                                   â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”Œ Analytics Endpoints (NEW):                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET  /api/v1/analytics/matches/{match_id}                    â”‚  â”‚
â”‚  â”‚ GET  /api/v1/analytics/matches/{match_id}/players            â”‚  â”‚
â”‚  â”‚ GET  /api/v1/analytics/players/{player_id}/metrics           â”‚  â”‚
â”‚  â”‚ GET  /api/v1/analytics/players/{player_id}/timeseries/{type} â”‚  â”‚
â”‚  â”‚ GET  /api/v1/analytics/players/{player_id}/heatmap           â”‚  â”‚
â”‚  â”‚ GET  /api/v1/analytics/teams/{side}/metrics                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“ Pydantic Schemas:                                                â”‚
â”‚  â€¢ PlayerMetricsSummary    â€¢ HeatmapResponse                        â”‚
â”‚  â€¢ TimeSeriesDataPoint     â€¢ MatchAnalyticsSummary                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ§  ANALYTICS PROCESSING LAYER (NEW)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ“Š Physical Metrics Engine (app/analytics/physical.py):            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Distance Calculation:                                     â”‚    â”‚
â”‚  â”‚   - Point-to-point Euclidean distance                      â”‚    â”‚
â”‚  â”‚   - Cumulative sum â†’ Total Distance                        â”‚    â”‚
â”‚  â”‚   - Per-minute breakdown                                    â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Speed Analysis:                                           â”‚    â”‚
â”‚  â”‚   - Instantaneous: distance/time                           â”‚    â”‚
â”‚  â”‚   - Rolling average                                         â”‚    â”‚
â”‚  â”‚   - Top speed extraction                                    â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Acceleration:                                             â”‚    â”‚
â”‚  â”‚   - dv/dt from speed time series                           â”‚    â”‚
â”‚  â”‚   - Max accel/decel                                         â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Sprint Detection:                                         â”‚    â”‚
â”‚  â”‚   - Threshold: >7.0 m/s for >1 second                      â”‚    â”‚
â”‚  â”‚   - Event counting with duration validation                â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Stamina Analysis:                                         â”‚    â”‚
â”‚  â”‚   - Coefficient of variation                               â”‚    â”‚
â”‚  â”‚   - Rolling 60s window average                             â”‚    â”‚
â”‚  â”‚   - Consistency index (0-100)                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ğŸ—ºï¸ Heatmap Generation Engine (app/analytics/heatmap.py):          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ 2D Grid Creation:                                         â”‚    â”‚
â”‚  â”‚   - Default: 40Ã—25 bins                                     â”‚    â”‚
â”‚  â”‚   - Pitch: 105m Ã— 68m                                       â”‚    â”‚
â”‚  â”‚   - Position â†’ Bin mapping                                  â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Gaussian Smoothing:                                       â”‚    â”‚
â”‚  â”‚   - 2D kernel convolution                                   â”‚    â”‚
â”‚  â”‚   - Configurable sigma                                      â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Team Aggregation:                                         â”‚    â”‚
â”‚  â”‚   - Sum individual player heatmaps                          â”‚    â”‚
â”‚  â”‚   - Normalize intensity                                     â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ â€¢ Zone Analysis:                                            â”‚    â”‚
â”‚  â”‚   - Defensive/Middle/Attacking thirds                       â”‚    â”‚
â”‚  â”‚   - Left/Center/Right channels                              â”‚    â”‚
â”‚  â”‚   - Occupancy percentage                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”§ Utility Functions (app/analytics/utils.py):                     â”‚
â”‚  â€¢ Trajectory smoothing    â€¢ Distance calculations                  â”‚
â”‚  â€¢ Angle calculations      â€¢ Direction change detection             â”‚
â”‚  â€¢ Convex hull area        â€¢ Position interpolation                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âš™ï¸ BACKGROUND PROCESSING LAYER                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Celery + Redis                                                      â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“‹ analytics_computation_task (UPDATED):                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Get video and tracks from database                      â”‚    â”‚
â”‚  â”‚ 2. For each player track:                                   â”‚    â”‚
â”‚  â”‚    a. Load track points (ordered by timestamp)             â”‚    â”‚
â”‚  â”‚    b. Validate metric coordinates (x_m, y_m)               â”‚    â”‚
â”‚  â”‚    c. Convert to TrackPointData objects                    â”‚    â”‚
â”‚  â”‚    d. Compute physical metrics via PhysicalMetricsEngine   â”‚    â”‚
â”‚  â”‚    e. Save aggregate metrics to player_metrics             â”‚    â”‚
â”‚  â”‚    f. Save time series to player_metric_timeseries         â”‚    â”‚
â”‚  â”‚    g. Generate heatmap via HeatmapEngine                   â”‚    â”‚
â”‚  â”‚    h. Save heatmap to player_heatmaps                      â”‚    â”‚
â”‚  â”‚ 3. Commit transaction                                       â”‚    â”‚
â”‚  â”‚ 4. Return metrics_computed, heatmaps_created               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”„ Trigger: Automatically after Phase 1 video processing completes â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’¾ PERSISTENCE LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL Database                                                 â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“Š Analytics Tables (NEW):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ player_metrics                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ id (UUID)                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ player_id (UUID) â†’ tracks.id                            â”‚    â”‚
â”‚  â”‚ â”œâ”€ match_id (UUID) â†’ matches.id                            â”‚    â”‚
â”‚  â”‚ â”œâ”€ video_id (UUID) â†’ videos.id                             â”‚    â”‚
â”‚  â”‚ â”œâ”€ metric_name (ENUM: MetricType)                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ numeric_value (FLOAT)                                   â”‚    â”‚
â”‚  â”‚ â”œâ”€ unit (VARCHAR)                                           â”‚    â”‚
â”‚  â”‚ â””â”€ metadata (JSONB)                                         â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ Indexes:                                                    â”‚    â”‚
â”‚  â”‚ â€¢ (player_id, match_id)                                     â”‚    â”‚
â”‚  â”‚ â€¢ (match_id)                                                â”‚    â”‚
â”‚  â”‚ â€¢ (metric_name)                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ player_metric_timeseries                                    â”‚    â”‚
â”‚  â”‚ â”œâ”€ id (UUID)                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ player_id (UUID)                                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ match_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ video_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ timestamp (FLOAT)                                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ frame_number (INT)                                       â”‚    â”‚
â”‚  â”‚ â”œâ”€ metric_type (ENUM: TimeSeriesMetricType)                â”‚    â”‚
â”‚  â”‚ â””â”€ value (FLOAT)                                            â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ Indexes:                                                    â”‚    â”‚
â”‚  â”‚ â€¢ (player_id, match_id)                                     â”‚    â”‚
â”‚  â”‚ â€¢ (player_id, timestamp)                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ player_heatmaps                                             â”‚    â”‚
â”‚  â”‚ â”œâ”€ id (UUID)                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ player_id (UUID)                                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ match_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ video_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ grid_width (INT)                                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ grid_height (INT)                                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ heatmap_data (JSONB) â†’ 2D array                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ pitch_length (FLOAT)                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ pitch_width (FLOAT)                                      â”‚    â”‚
â”‚  â”‚ â”œâ”€ total_positions (INT)                                    â”‚    â”‚
â”‚  â”‚ â””â”€ max_intensity (FLOAT)                                    â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚ Indexes:                                                    â”‚    â”‚
â”‚  â”‚ â€¢ (player_id, match_id)                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ team_metrics                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ id (UUID)                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ match_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ video_id (UUID)                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ team_side (VARCHAR)                                      â”‚    â”‚
â”‚  â”‚ â”œâ”€ metric_name (VARCHAR)                                    â”‚    â”‚
â”‚  â”‚ â”œâ”€ numeric_value (FLOAT)                                    â”‚    â”‚
â”‚  â”‚ â””â”€ metadata (JSONB)                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”„ Existing Tables (Phase 1):                                       â”‚
â”‚  â€¢ matches        â€¢ videos        â€¢ tracks                          â”‚
â”‚  â€¢ track_points   â€¢ calibration_matrices                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ“¦ TECHNOLOGY STACK                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Backend:                                                            â”‚
â”‚  â€¢ Python 3.10+      â€¢ FastAPI         â€¢ SQLAlchemy                 â”‚
â”‚  â€¢ Celery            â€¢ Redis           â€¢ NumPy                      â”‚
â”‚  â€¢ SciPy             â€¢ Pydantic        â€¢ Alembic                    â”‚
â”‚                                                                      â”‚
â”‚  Frontend:                                                           â”‚
â”‚  â€¢ React 18          â€¢ Tailwind CSS    â€¢ React Query                â”‚
â”‚  â€¢ Recharts          â€¢ Axios           â€¢ React Router               â”‚
â”‚                                                                      â”‚
â”‚  Database:                                                           â”‚
â”‚  â€¢ PostgreSQL 14+                                                    â”‚
â”‚                                                                      â”‚
â”‚  Infrastructure:                                                     â”‚
â”‚  â€¢ Docker (optional) â€¢ Nginx (production)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video Upload â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: CV Pipeline â”‚ (Frame Extraction â†’ Detection â†’ Tracking)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Track Points Saved  â”‚ (x_m, y_m, timestamp, etc.)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Auto-Trigger
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Analytics Task    â”‚
â”‚ (analytics_computation_task)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Physical Metricsâ”‚          â”‚ Heatmap Generatorâ”‚
â”‚ Engine          â”‚          â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Distance      â”‚          â”‚ â€¢ 2D Grid        â”‚
â”‚ â€¢ Speed         â”‚          â”‚ â€¢ Gaussian Blur  â”‚
â”‚ â€¢ Acceleration  â”‚          â”‚ â€¢ Normalization  â”‚
â”‚ â€¢ Sprints       â”‚          â”‚                  â”‚
â”‚ â€¢ Stamina       â”‚          â”‚                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚
     â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ player_metrics   â”‚      â”‚ player_heatmaps  â”‚
â”‚ (aggregate data) â”‚      â”‚ (spatial data)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                        â”‚
      â–¼                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ player_metric_      â”‚        â”‚
â”‚ timeseries          â”‚        â”‚
â”‚ (time series data)  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
      â”‚                        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Database     â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Query via FastAPI
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ React Frontendâ”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ User sees charts,â”‚
       â”‚ metrics, heatmapsâ”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Metric Computation Details

### Speed Calculation
```
For each pair of consecutive track points:
  distance = âˆš[(xâ‚‚-xâ‚)Â² + (yâ‚‚-yâ‚)Â²]  (Euclidean)
  time_diff = tâ‚‚ - tâ‚
  speed = distance / time_diff  (m/s)
```

### Acceleration Calculation
```
For each pair of consecutive speed measurements:
  speed_diff = vâ‚‚ - vâ‚
  time_diff = tâ‚‚ - tâ‚
  acceleration = speed_diff / time_diff  (m/sÂ²)
```

### Stamina Index Calculation
```
1. Calculate distance per minute
2. Compute coefficient of variation:
   CV = (std_dev / mean) Ã— 100
3. Stamina Index = 100 - min(CV, 100)
   
Higher index = More consistent performance
Lower index = More fatigue/decline
```

### Heatmap Generation
```
1. Create NxM grid (40Ã—25 default)
2. For each position (x, y):
   col = floor(x / bin_width)
   row = floor(y / bin_height)
   grid[row][col] += 1
3. Apply Gaussian smoothing
4. Normalize to 0-1 range
```

---

## ğŸ¯ Performance Metrics

### Database Query Optimization
- âœ… Composite indexes on (player_id, match_id)
- âœ… Timestamp index for time series queries
- âœ… Match-level indexes for aggregation

### Frontend Performance
- âœ… React Query caching (5 min stale time)
- âœ… Lazy loading of charts
- âœ… Responsive design with CSS Grid

### Computation Efficiency
- âœ… NumPy vectorized operations
- âœ… Batch database inserts
- âœ… Celery for async processing

---

## ğŸ” API Authentication (Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Login  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JWT Token    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Request          â”‚
â”‚ Header: Authorizationâ”‚
â”‚ Bearer <token>       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token Validation     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analytics Data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ—ï¸ Architecture Complete - Ready for Production Deployment! ğŸ—ï¸**
